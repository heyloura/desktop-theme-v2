{{ define "main" }}
  <script type="module">
  import clippy from 'https://unpkg.com/clippyts@1.0.4/dist/index.js';




const ClippyDemo = (function() {
    //const availableAgents = ['Bonzi', 'Clippy', 'F1', 'Genie', 'Genius', 'Links', 'Merlin', 'Peedy', 'Rocky', 'Rover']
    const availableAgents = ['Bonzi', 'Clippy', 'F1', 'Genie', 'Genius', 'Links', 'Merlin', 'Peedy', 'Rocky', 'Rover']

    const talks = [
        'How can i help you?',
        'Nice day!',
        'Glad to meet you.',
        'At your service',
        'Helloo'
    ]

    function init() {
        this.$el = document.querySelector('.my-clippy')
    }

    function nextAgent() {
        let agentName = availableAgents[Math.floor(Math.random() * (availableAgents.length))]
        if (!agentName) return;

        clippy.load({
            name: agentName,
            selector: "my-clippy",
            successCb: agent => {
                window[agentName] = agent
                agent.show();

                // Speak on click and start
                const speak = () => {
                    agent.speak('I am ' + agentName + ', ' + talks[~~(Math.random() * talks.length)])
                    agent.animate()
                }
                agent._el.addEventListener('click', () => {
                  
                  speak();
                });
                speak();

                // Animate randomly
                setInterval(() => {
                    agent.animate()
                }, 3000 + (Math.random() * 4000))
            }
        });
    } 
    function destroy() {
        this.$el.innerHTML = ''
    }

    return {
        init,
        nextAgent,
        destroy,

    }
})();


// window.onload = () => {
//     ClippyDemo.init();
//     ClippyDemo.nextAgent();
//     document.getElementById('next-agent').addEventListener('click', () => {
//         ClippyDemo.destroy();
//         ClippyDemo.nextAgent();
//     });
// }



    

    
  // clippy.load({
  //   name: 'Clippy',
  //   selector: 'my-clippy',
  // 	successCb: (agent) => {
  //   	console.log("Loaded!");
  //   	agent.show();
  //     agent.speak("Welcome to the DEMO!");
  //     agent.animate();
  //   },
  //   failCb: (e) => {
  //   	console.error(e)
  //   }
  // })

</script>
<script>
$( "#dialogStatus" ).dialog("close")</script>
{{ end }}
